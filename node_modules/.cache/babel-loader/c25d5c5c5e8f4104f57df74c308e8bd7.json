{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useState, useEffect, useCallback } from 'react';\n\nconst fetchCurrentWeather = ({\n  authorizationKey,\n  locationName\n}) => {\n  // 加上 return 直接把 fetch API 回傳的 Promise 再回傳出去\n  return fetch(`https://opendata.cwb.gov.tw/api/v1/rest/datastore/O-A0003-001?Authorization=${authorizationKey}&locationName=${locationName}\n  `).then(resp => resp.json()).then(data => {\n    // STEP 1：定義 locationData 把回傳的資料中會用到的部分取出來\n    const locationData = data.records.location[0]; // STEP 2：將風速（WDSD）和氣溫（TEMP）的資料取出\n\n    const weatherElements = locationData.weatherElement.reduce((neededElements, item) => {\n      if (['WDSD', 'TEMP'].includes(item.elementName)) {\n        neededElements[item.elementName] = item.elementValue;\n      }\n\n      return neededElements;\n    }, {}); //STEP 3: 回傳資料\n\n    return {\n      locationName: locationData.locationName,\n      temperature: weatherElements.TEMP,\n      windSpeed: weatherElements.WDSD,\n      observationTime: locationData.time.obsTime\n    };\n  });\n};\n\nconst fetchWeatherForecast = ({\n  authorizationKey,\n  cityName\n}) => {\n  return fetch(`https://opendata.cwb.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=${authorizationKey}&locationName=${cityName}`).then(resp => resp.json()).then(data => {\n    const locationData = data.records.location[0];\n    const weatherElements = locationData.weatherElement.reduce((neededElements, item) => {\n      if (['Wx', 'PoP', 'CI'].includes(item.elementName)) {\n        neededElements[item.elementName] = item.time[0].parameter;\n      }\n\n      return neededElements;\n    }, {});\n    return {\n      description: weatherElements.Wx.parameterName,\n      weatherCode: weatherElements.Wx.parameterValue,\n      rainPossibility: weatherElements.PoP.parameterName,\n      comfortability: weatherElements.CI.parameterName\n    };\n  });\n};\n\nconst useWeatherAPI = ({\n  locationName,\n  cityName,\n  authorizationKey\n}) => {\n  _s();\n\n  const [weatherElement, setWeatherElement] = useState({\n    locationName: '',\n    temperature: 0,\n    windSpeed: 0,\n    observationTime: new Date(),\n    description: '',\n    rainPossibility: 0,\n    weatherCode: 0,\n    comfortability: '',\n    isLoading: false\n  }); // 確保 fetchData 不會因為元件重新轉譯而變成新的\n\n  const fetchData = useCallback(async () => {\n    setWeatherElement(prevState => ({ ...prevState,\n      isLoading: true\n    }));\n    const [currentWeather, weatherForecast] = await Promise.all([fetchCurrentWeather({\n      authorizationKey,\n      locationName\n    }), fetchWeatherForecast({\n      authorizationKey,\n      cityName\n    })]);\n    setWeatherElement({ ...currentWeather,\n      ...weatherForecast,\n      isLoading: false\n    });\n  }, [authorizationKey, locationName, cityName]);\n  useEffect(() => {\n    // console.log('execute function is useEffect');\n    fetchData();\n  }, [fetchData]);\n  return [weatherElement, fetchData];\n};\n\n_s(useWeatherAPI, \"oWUetRCFX0adpFeuy9WZMr/sx+E=\");\n\nexport default useWeatherAPI;","map":{"version":3,"sources":["/Users/michelle/Desktop/Dastine/web/realtime-weather-app/src/hooks/useWeatherAPI.js"],"names":["useState","useEffect","useCallback","fetchCurrentWeather","authorizationKey","locationName","fetch","then","resp","json","data","locationData","records","location","weatherElements","weatherElement","reduce","neededElements","item","includes","elementName","elementValue","temperature","TEMP","windSpeed","WDSD","observationTime","time","obsTime","fetchWeatherForecast","cityName","parameter","description","Wx","parameterName","weatherCode","parameterValue","rainPossibility","PoP","comfortability","CI","useWeatherAPI","setWeatherElement","Date","isLoading","fetchData","prevState","currentWeather","weatherForecast","Promise","all"],"mappings":"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","sourcesContent":["import { useState, useEffect, useCallback } from 'react';\n\nconst fetchCurrentWeather = ({authorizationKey, locationName}) => {\n  // 加上 return 直接把 fetch API 回傳的 Promise 再回傳出去\n  return fetch(`https://opendata.cwb.gov.tw/api/v1/rest/datastore/O-A0003-001?Authorization=${authorizationKey}&locationName=${locationName}\n  `)\n  .then((resp) => resp.json())\n  .then((data) => {\n    // STEP 1：定義 locationData 把回傳的資料中會用到的部分取出來\n    const locationData = data.records.location[0];\n\n    // STEP 2：將風速（WDSD）和氣溫（TEMP）的資料取出\n    const weatherElements = locationData.weatherElement.reduce(\n      (neededElements, item) => {\n        if (['WDSD', 'TEMP'].includes(item.elementName)) {\n          neededElements[item.elementName] = item.elementValue;\n        }\n        return neededElements;\n      },\n      {}\n    );     \n      \n    //STEP 3: 回傳資料\n    return {\n      locationName: locationData.locationName,\n      temperature: weatherElements.TEMP,\n      windSpeed: weatherElements.WDSD,\n      observationTime: locationData.time.obsTime,\n    }\n    \n  });\n};\n  \nconst fetchWeatherForecast = ({authorizationKey, cityName}) => {\n  return fetch(`https://opendata.cwb.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=${authorizationKey}&locationName=${cityName}`)\n  .then((resp) => resp.json())\n  .then((data) => {\n    const locationData = data.records.location[0];\n    const weatherElements = locationData.weatherElement.reduce(\n    (neededElements, item)=>{\n      if(['Wx','PoP','CI'].includes(item.elementName)){\n      neededElements[item.elementName] = item.time[0].parameter;\n      }\n      return neededElements;\n    },\n    {}\n    )\n\n    return {\n      description: weatherElements.Wx.parameterName,\n      weatherCode: weatherElements.Wx.parameterValue,\n      rainPossibility: weatherElements.PoP.parameterName,\n      comfortability: weatherElements.CI.parameterName,\n    }\n  });\n}\n\nconst useWeatherAPI = ({ locationName, cityName, authorizationKey }) => {\n  const [weatherElement, setWeatherElement] = useState({\n    locationName: '',\n    temperature: 0,\n    windSpeed: 0,\n    observationTime: new Date(),\n    description: '',\n    rainPossibility: 0,\n    weatherCode: 0,\n    comfortability: '',\n    isLoading: false,\n  });\n\n  // 確保 fetchData 不會因為元件重新轉譯而變成新的\n  const fetchData = useCallback(async () => {\n    setWeatherElement((prevState) => ({\n      ...prevState,\n      isLoading: true,\n    }));\n\n    const [currentWeather, weatherForecast] = await Promise.all([\n      fetchCurrentWeather({authorizationKey, locationName}), \n      fetchWeatherForecast({authorizationKey, cityName}),\n    ]);\n\n    setWeatherElement({\n      ...currentWeather,\n      ...weatherForecast,\n      isLoading: false,\n    });\n  },[authorizationKey, locationName, cityName]);\n\n  useEffect(()=>{\n    // console.log('execute function is useEffect');\n    fetchData();\n  },[fetchData])\n\n  return [weatherElement, fetchData];\n};\n\nexport default useWeatherAPI;\n"]},"metadata":{},"sourceType":"module"}